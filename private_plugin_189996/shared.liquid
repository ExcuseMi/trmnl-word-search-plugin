<style>
  #puzzle-grid {
    table-layout: fixed;
    border-collapse: collapse;
    aspect-ratio: 1;
  }
  #puzzle-grid td {
    border: solid 1px black;
    aspect-ratio: 1;
    font-weight: 500;
    text-align: center;
    vertical-align: middle;
  }
</style>
{% template grid %}
<table id="puzzle-grid" class="text--center {{grid_classes}}">
  {% for i in (0..gridSize) %}
    {% if i < gridSize %}
      <tr>
        {% for j in (0..gridSize) %}
          {% if j < gridSize %}
            {% assign cell_index = i | times: gridSize | plus: j %}
            <td class="{{cell_classes}}" data-value-fit="true">{{ grid | slice: cell_index, 1 }}</td>
          {% endif %}
        {% endfor %}
      </tr>
    {% endif %}
  {% endfor %}
</table>
{% endtemplate %}

{% template puzzle %}
{% liquid
  assign difficulty = trmnl.plugin_settings.custom_fields_values.difficulty | default: "easy"
  assign show_solution = trmnl.plugin_settings.custom_fields_values.show_solution | default: "yes"
  assign theme = puzzle.theme
  assign gridSize = puzzle.gridSize
  assign grid = puzzle.grid
  assign wordlist = puzzle.wordlist
  assign id = puzzle.id
  assign qr_data = 'https://excusemi.github.io/trmnl-word-search-plugin/?id=' | append: id
%}


{% comment %} View 1: full — grid left, words/QR stacked right. Portrait: grid top, words+QR side by side below {% endcomment %}
{% if view == 1 %}
<div class="layout layout--stretch layout--col">
  <div class="flex flex--row portrait:flex--col stretch gap--large">

    {% render "grid", grid: grid, gridSize: gridSize %}

    <div class="flex flex--col portrait:flex--row gap--large">
      {% if show_words %}
      <div class="flex flex--col flex--top">
        <span class="label label--inverted lg:label--large">{{ theme | upcase }}</span>
        {% if difficulty != "insane" %}
        <div class="grid grid--cols-2">
          {% for word in wordlist %}
          <span class="label lg:label--large">{{ word }}</span>
          {% endfor %}
        </div>
        {% else %}
        <span class="label lg:label--large">{{ wordlist.size }} WORDS</span>
        {% endif %}
      </div>
      {% endif %}

      {% if show_solution == "yes" and show_qr %}
      <div class="flex flex--col flex--top">
        <span class="label label--inverted lg:label--large">SOLUTION</span>
        {{ qr_data | qr_code: 3, 'm' }}
      </div>
      {% endif %}
    </div>

  </div>
</div>

{% comment %} View 2: half horizontal — grid left, words+QR right, side by side always {% endcomment %}
{% elsif view == 2 %}
<div class="layout layout--stretch layout--col">
  <div class="flex flex--row stretch gap--large">

    <div class="flex flex--col stretch">
      {% render "grid", grid: grid, gridSize: gridSize %}
    </div>

    <div class="flex flex--col stretch gap--large">
      {% if show_words %}
      <div class="flex flex--col flex--top">
        <span class="label label--inverted">{{ theme | upcase }}</span>
        {% if difficulty != "insane" %}
        <div class="grid grid--cols-2">
          {% for word in wordlist %}
          <span class="label">{{ word }}</span>
          {% endfor %}
        </div>
        {% else %}
        <span class="label">{{ wordlist.size }} WORDS</span>
        {% endif %}
      </div>
      {% endif %}

      {% if show_solution == "yes" and show_qr %}
      <div class="flex flex--col flex--top">
        <span class="label label--inverted">SOLUTION</span>
        {{ qr_data | qr_code: 3, 'm' }}
      </div>
      {% endif %}
    </div>

  </div>
</div>
{% comment %} View 3: half vertical — grid top, words+QR below side by side {% endcomment %}
{% elsif view == 3 %}
<div class="layout layout--stretch layout--col">
  <div class="flex flex--col stretch gap--large">

    {% render "grid", grid: grid, gridSize: gridSize %}

    <div class="flex flex--row gap--large">
      {% if show_words %}
      <div class="flex flex--col flex--top">
        <span class="label label--inverted lg:label--large">{{ theme | upcase }}</span>
        {% if difficulty != "insane" %}
        <div class="grid grid--cols-2">
          {% for word in wordlist %}
          <span class="label lg:label--large">{{ word }}</span>
          {% endfor %}
        </div>
        {% else %}
        <span class="label lg:label--large">{{ wordlist.size }} WORDS</span>
        {% endif %}
      </div>
      {% endif %}

      {% if show_solution == "yes" and show_qr %}
      <div class="flex flex--col flex--top portrait:hidden">
        <span class="label label--inverted lg:label--large">SOLUTION</span>
        {{ qr_data | qr_code: 3, 'm' }}
      </div>
      {% endif %}
    </div>

  </div>
</div>

{% comment %} View 4: quadrant — just the grid, no words or QR {% endcomment %}
{% elsif view == 4 %}
<div class="layout layout--stretch layout--col">
  <div class="flex flex--row flex--center stretch">
    <div class="flex flex--col stretch" style="max-width: min(100%, 100vh);">
      {% render "grid", grid: grid, gridSize: gridSize %}
    </div>
  </div>
</div>

{% endif %}


{% endtemplate %}